<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ObstacleAvoidance</title>
	<style>
		body {
			height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
			margin: 0 auto;
			background-color: #0f172a;
		}
		canvas {
			border: 1px solid #3d596d;
			background-color: #1e293b;
			border-radius: 0.5rem;
		}
	</style>
</head>
<body>
	<canvas width="600px" height="400px"></canvas>
	
	<script src="game.js"></script>
	<script>
		const canvas = document.querySelector('canvas');
		const ctx = canvas.getContext('2d');

		let frame = 0; 
		let walls = [];
		const user = new User();
		
		let procedure;
		canvas.addEventListener("mouseenter", function() {
			if(procedure) {
				clearInterval(procedure);
			}
			procedure = setInterval(function() {
				user.fly()
			}, 100);
		});
		canvas.addEventListener("mouseleave", function() {
			if(procedure) {
				clearInterval(procedure);
			}
			procedure = setInterval(function() {
				user.fall()
			}, 100);
		});

		// main
		let main = setInterval(function(){
            // console.log(main, typeof main); // 메인 타입은 number
			if(frame%20 === 0) {	// frame이 20의 배수일 때
				walls.push(new Wall('#06b6d4', 10 + Math.random()*20));
			};
			ctx.clearRect(0, 0, 600,400);
			ctx.fillStyle = '#e5e7eb';
			ctx.fillRect(...user.toArray());
			ctx.fillText(`SCORE : ${frame}`, 6, 13)

			walls.forEach(function(obj) {
				obj.slide();	// 모든 wall에게 이동 함수 적용
				ctx.fillStyle = obj.color;
				ctx.fillRect(...obj.toArray());
			});
			// 밖으로 빠져 나간 wall 객체는 제거
			walls = walls.filter(function(obj) {
				if(obj.x+obj.w > 0) {
					return true;
				}
			});
			
			console.log(walls.length);

			frame++	// frame 추가

			// user하고 wall하고 충돌이 하나라도 있을 때 interval을 멈추게
			
			let crashed = walls.some(function(obj) {
				return obj.crashWith(user)
			});
			if(crashed) {
				clearInterval(main);
				ctx.fillStyle = 'rgb(244 63 94/.25)';
				ctx.fillRect(0, 70, 600, 260);
				ctx.font = '900 80px Arial';
				ctx.textAlign = 'center'
				ctx.fillStyle = '#e5e7eb';
				ctx.fillText('GAME OVER', 300, 220);
			}
		} ,100);
		
		
	</script>
</body>
</html>